<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>予約 - K9 Harmony</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/reservation.css">
  
  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  
  <!-- Square Web Payments SDK -->
  <script src="https://sandbox.web.squarecdn.com/v1/square.js"></script>
  
  <!-- Lottie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
</head>
<body>
  <!-- ローディングオーバーレイ -->
  <div id="loading-overlay" class="loading-overlay">
    <div id="lottie-animation" class="loading-animation"></div>
    <div class="loading-text">読み込み中...</div>
  </div>

  <!-- メインコンテナ -->
  <div class="page">
    <!-- ヘッダー -->
    <header class="header">
      <h1 class="header-title">レッスン予約</h1>
    </header>

    <div class="container">
      <!-- ステップインジケーター -->
      <div class="step-indicator">
        <div class="step" data-step="1">
          <div class="step-number">1</div>
          <div class="step-label">犬を選択</div>
        </div>
        <div class="step" data-step="2">
          <div class="step-number">2</div>
          <div class="step-label">トレーナー</div>
        </div>
        <div class="step" data-step="3">
          <div class="step-number">3</div>
          <div class="step-label">日時選択</div>
        </div>
        <div class="step" data-step="4">
          <div class="step-number">4</div>
          <div class="step-label">コース選択</div>
        </div>
        <div class="step" data-step="5">
          <div class="step-number">5</div>
          <div class="step-label">確認・決済</div>
        </div>
      </div>

      <!-- ステップ1: 犬選択 -->
      <div id="step-1" class="hidden">
        <div class="card">
          <h2 class="card-title">レッスンを受ける犬を選択してください</h2>
          <p class="card-subtitle">複数選択可能です</p>
          <div id="dog-list" class="dog-list"></div>
        </div>
      </div>

      <!-- ステップ1.5: トレーナー選択 -->
      <div id="step-trainer" class="hidden">
        <div class="card">
          <h2 class="card-title">トレーナーを選択してください</h2>
          <div id="trainer-list" class="trainer-list"></div>
        </div>
      </div>

      <!-- ステップ2: 日時選択 -->
      <div id="step-2" class="hidden">
        <div class="card">
          <h2 class="card-title">日時を選択してください</h2>
          
          <!-- カレンダー -->
          <div class="date-selector">
            <div class="calendar">
              <div class="calendar-header">
                <div class="calendar-month" id="calendar-month">2026年 1月</div>
                <div class="calendar-nav">
                  <button class="calendar-nav-btn" id="calendar-prev">◀</button>
                  <button class="calendar-nav-btn" id="calendar-next">▶</button>
                </div>
              </div>
              
              <div class="calendar-weekdays">
                <div class="calendar-weekday">日</div>
                <div class="calendar-weekday">月</div>
                <div class="calendar-weekday">火</div>
                <div class="calendar-weekday">水</div>
                <div class="calendar-weekday">木</div>
                <div class="calendar-weekday">金</div>
                <div class="calendar-weekday">土</div>
              </div>
              
              <div class="calendar-dates" id="calendar-dates"></div>
            </div>
          </div>
          
          <!-- 時間選択 -->
          <div class="card-subtitle mt-4">時間を選択</div>
          <div id="time-slots" class="time-slots"></div>
        </div>
      </div>

      <!-- ステップ3: 商品選択 -->
      <div id="step-3" class="hidden">
        <div class="card">
          <h2 class="card-title">レッスンコースを選択してください</h2>
          <div id="product-list" class="product-list"></div>
        </div>
      </div>

      <!-- ステップ4: 確認・決済 -->
      <div id="step-4" class="hidden">
        <!-- 予約内容確認 -->
        <div class="card">
          <h2 class="card-title">予約内容の確認</h2>
          <div class="confirmation-section">
            <div class="confirmation-item">
              <div class="confirmation-label">犬</div>
              <div class="confirmation-value" id="confirm-dog">-</div>
            </div>
            <div class="confirmation-item">
              <div class="confirmation-label">トレーナー</div>
              <div class="confirmation-value" id="confirm-trainer">-</div>
            </div>
            <div class="confirmation-item">
              <div class="confirmation-label">日時</div>
              <div class="confirmation-value" id="confirm-datetime">-</div>
            </div>
            <div class="confirmation-item">
              <div class="confirmation-label">レッスンコース</div>
              <div class="confirmation-value" id="confirm-product">-</div>
            </div>
          </div>
        </div>

        <!-- 決済情報 -->
        <div class="card">
          <h2 class="card-title">お支払い情報</h2>
          
          <!-- 料金サマリー -->
          <div class="payment-summary mb-3">
            <div class="summary-row">
              <div class="summary-label">レッスン料金</div>
              <div class="summary-value" id="summary-price">¥0</div>
            </div>
            <div class="summary-row">
              <div class="summary-label">消費税（10%）</div>
              <div class="summary-value" id="summary-tax">¥0</div>
            </div>
            <div class="summary-row">
              <div class="summary-label">複数頭料金</div>
              <div class="summary-value" id="summary-multi-dog">¥0</div>
            </div>
            <div class="summary-row total">
              <div class="summary-label">合計</div>
              <div class="summary-value total" id="summary-total">¥0</div>
            </div>
          </div>
          
          <!-- カード入力フォーム -->
          <div class="card-subtitle mb-2">クレジットカード情報</div>
          <div id="card-container"></div>
          
          <div class="form-group mt-3">
            <p class="text-secondary" style="font-size: 12px;">
              ※ このシステムは安全なSquare決済システムを使用しています。<br>
              ※ カード情報は暗号化されて保護されます。
            </p>
          </div>
        </div>
      </div>

      <!-- 成功画面 -->
      <div id="success-page" class="hidden">
        <div class="card text-center">
          <div style="font-size: 64px; margin-bottom: 16px;">✅</div>
          <h2 class="card-title">予約が完了しました！</h2>
          <p class="text-secondary mb-4">
            予約確認のメッセージをLINEでお送りしました。<br>
            当日お会いできることを楽しみにしています！
          </p>
          <button class="btn btn-primary btn-lg btn-block" onclick="app.handleComplete()">
            完了
          </button>
        </div>
      </div>

      <!-- アクションボタン -->
      <div id="action-buttons" class="action-buttons">
        <button id="btn-back" class="btn btn-outline hidden">戻る</button>
        <button id="btn-next" class="btn btn-primary">次へ</button>
        <button id="btn-confirm" class="btn btn-primary btn-lg hidden">予約を確定する</button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="js/config.js?v=9"></script>
  <script src="js/liff-handler.js?v=9"></script>
  <script src="js/api-client.js?v=9"></script>
  <script src="js/reservation.js?v=9"></script>
</body>
</html>