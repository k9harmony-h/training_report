<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K9 Harmony | æ„›çŠ¬ã®æ€§æ ¼è¨ºæ–­</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ES72ND3BPP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ES72ND3BPP');
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Zen+Kurenaido&display=swap" rel="stylesheet">

    <style>
        /* [Design System Settings] */
        :root {
            --active-highlight: #57C3C2;
            --neutral-border: #C7B299;
            --progress-track: #2F5D62;
            --mist-background: #FDFBF8;
            --text-main: #2C3E50;
            --text-black: #000000;
            --luxury-transition: 0.8s cubic-bezier(0.25, 0.1, 0.25, 1.0);
            --global-radius: 5px;
            --group-margin: 40px;
        }

        /* [Base Styles] */
        body {
            font-family: 'Noto Serif JP', serif;
            background-color: #fafafa; /* èµ·å‹•æ™‚ã®ãƒ™ãƒ¼ã‚¹è‰² */
            color: var(--text-main);
            margin: 0; padding: 0; min-height: 100vh;
            overflow-x: hidden;
        }

        /* [Background Texture] æ¸©ã‹ã¿ã®ã‚ã‚‹é›²é¾ç´™ï¼ˆãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£ãƒ•ãƒªãƒ¼ç´ æï¼‰ */
        #washiBg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /* ç¹Šç¶­æ„ŸãŒå¼·ãæ¸©ã‹ã¿ã®ã‚ã‚‹é›²é¾ç´™ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ */
            background-image: linear-gradient(rgba(253, 251, 248, 0.7), rgba(253, 251, 248, 0.7)),
                              url("https://www.transparenttextures.com/patterns/japanese-paper.png");
            background-attachment: fixed;
            opacity: 0; z-index: -1;
            transition: opacity 1.2s ease;
        }

        /* [Visual Log Stamp] */
        #logOverlay {
            position: fixed; top: 0; left: 0; width: 100%; background: rgba(47, 93, 98, 0.85);
            color: #FFF; font-size: 10px; padding: 4px 10px; z-index: 9999; pointer-events: none;
            font-family: monospace; line-height: 1.5;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 40px 20px; box-sizing: border-box; position: relative; }
        
        /* [Opening Animation Targets] */
        .reveal-item { opacity: 0; transform: translateY(15px); }
        .reveal-active { animation: revealEffect 0.8s forwards cubic-bezier(0.25, 0.1, 0.25, 1.0); }

        @keyframes revealEffect {
            to { opacity: 1; transform: translateY(0); }
        }

        /* [Layout & Components] */
        .header { text-align: center; margin-bottom: 50px; }
        .logo-main { width: 180px; }

        .main-title-area { text-align: center; margin-bottom: var(--group-margin); }
        .main-title { font-size: 1.8rem; font-weight: 700; margin: 0; color: var(--progress-track); letter-spacing: 0.08em; }
        .sub-title-badge { font-size: 0.75rem; color: var(--neutral-border); letter-spacing: 0.05em; display: block; margin-top: 5px; margin-bottom: 40px; }
        .description-text { font-size: 0.9rem; line-height: 2; color: var(--text-main); margin-bottom: 30px; }

        .q-unit {
            background: rgba(255, 255, 255, 0.5); border: 1px solid var(--neutral-border);
            padding: 25px 20px; border-radius: var(--global-radius);
            margin-bottom: var(--group-margin); backdrop-filter: blur(2px);
        }
        .q-text { font-size: 0.9rem; font-weight: bold; margin-bottom: 15px; color: var(--progress-track); }

        .home-card { background: rgba(255, 255, 255, 0.4); border: 1px solid var(--neutral-border); padding: 35px; border-radius: var(--global-radius); margin-bottom: 40px; }
        .input-group label { display: block; font-size: 0.8rem; margin-bottom: 15px; font-weight: bold; color: var(--progress-track); }
        .input-group input { 
            width: 100%; padding: 12px 0; border: none; border-bottom: 1px solid var(--neutral-border);
            background: transparent; font-size: 1.4rem; outline: none; transition: 0.4s; font-family: inherit;
        }
        .input-group input::placeholder { color: var(--neutral-border); opacity: 0.1; }
        .input-group input:focus { border-bottom-color: var(--active-highlight); }

        /* [Option Buttons] å¸ç€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£… */
        .opt-group { display: flex; gap: 8px; justify-content: space-between; }
        .opt-btn {
            flex: 1; padding: 12px 2px; border: 1px solid var(--neutral-border); background: transparent;
            border-radius: var(--global-radius); cursor: pointer; font-size: 0.8rem; text-align: center; 
            transition: color 0.5s ease, border-color 0.5s ease; font-family: inherit;
            position: relative; overflow: hidden; z-index: 1;
        }
        /* æ“¬ä¼¼è¦ç´ ã«ã‚ˆã‚‹å¸ç€èƒŒæ™¯ */
        .opt-btn::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--active-highlight); z-index: -1; opacity: 0;
            /* 15pxä¸‹ã‹ã‚‰æ¹§ãä¸ŠãŒã‚‹åˆæœŸä½ç½® */
            transform: translateY(100%) translateY(15px);
            transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.6s ease;
            will-change: transform, opacity; /* å¯¾ç­–â‘¡: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– */
        }
        .opt-btn.selected { color: #FFF; border-color: var(--active-highlight); }
        .opt-btn.selected::before {
            opacity: 1; transform: translateY(0); /* å¸ç€å®Œäº†ä½ç½® */
        }

        .btn-container { text-align: center; margin-top: 20px; }
        .btn {
            width: 75%; padding: 20px; background: rgba(199, 178, 153, 0.2); color: var(--neutral-border);
            border: 1px solid var(--neutral-border); border-radius: var(--global-radius); font-size: 1rem; 
            cursor: pointer; transition: all 0.6s ease; font-family: inherit; font-weight: 700; letter-spacing: 0.1em;
        }
        .btn.btn-ready { background: var(--active-highlight); color: #FFF; border: none; box-shadow: 0 4px 15px rgba(87, 195, 194, 0.2); }

        /* [Transitions] */
        .page-section { position: absolute; top: 0; left: 0; width: 100%; opacity: 0; pointer-events: none; transition: var(--luxury-transition); }
        .page-section.active { opacity: 1; pointer-events: auto; position: relative; }
        .exit-left { transform: translateX(-50px); opacity: 0; }
        .exit-right { transform: translateX(50px); opacity: 0; }
        .enter-down { animation: enterDown var(--luxury-transition) forwards; }
        @keyframes enterDown {
            0% { transform: translateY(-30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* [Modals & Footer] */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.4);
            display: none; z-index: 1000; align-items: flex-start; justify-content: center; backdrop-filter: blur(10px);
        }
        .modal-content {
            background: #FFF; width: 92%; height: 75vh; margin-top: 5vh; border-radius: var(--global-radius);
            padding: 40px 30px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--neutral-border);
        }
        .policy-body { flex: 1; overflow-y: auto; font-size: 0.85rem; line-height: 2; color: #555; padding-right: 10px; }

        .site-footer { background: rgba(255, 255, 255, 0.4); border-top: 1px solid rgba(199, 178, 153, 0.2); padding: 60px 20px; text-align: center; font-size: 0.8rem; color: #7F8C8D; }
        .footer-logo-img { width: 140px; margin-bottom: 25px; opacity: 0.7; }
        .footer-info p { margin: 6px 0; }

        .hidden { display: none !important; }

        /* [Cheki Template] */
        #chekiWrapper { position: absolute; left: -9999px; }
        #chekiTemplate { width: 400px; background: #FFF; padding: 20px 20px 80px 20px; border: 1px solid #EEE; text-align: center; }
        .cheki-photo-area { width: 100%; aspect-ratio: 1/1; background: var(--mist-background); position: relative; overflow: hidden; border: 1px solid #F0F0F0; }
        .cheki-result-badge { position: absolute; top: 10px; left: -5px; background: var(--active-highlight); color: #FFF; padding: 8px 20px; font-size: 18px; font-weight: bold; transform: rotate(-25deg); transform-origin: top left; }
        .cheki-hashtag { position: absolute; bottom: 10px; right: 10px; font-size: 10px; color: var(--neutral-border); }
        
        /* æ‰‹æ›¸ããƒ•ã‚©ãƒ³ãƒˆã¯ç¶­æŒã—ã€æ•¬ç§°å‰Šé™¤ã«å¯¾å¿œ */
        .cheki-name-area { 
            margin-top: 35px; 
            font-family: 'Zen Kurenaido', sans-serif;
            font-size: 42px; 
            color: var(--text-black); 
            font-weight: bold; 
        }
    </style>
</head>
<body>
    <div id="logOverlay">æº–å‚™ä¸­...</div>
    <div id="washiBg"></div>

    <div class="container">
        <div class="header reveal-item" id="reveal-1">
            <img src="https://raw.githubusercontent.com/k9harmony-h/training_report/main/K9_logoFull.png" alt="K9 Harmony" class="logo-main">
        </div>

        <div id="sectionWrap">
            <section class="page-section active" id="page-home">
                <div class="main-title-area reveal-item" id="reveal-2">
                    <h1 class="main-title">æ„›çŠ¬ã®æ€§æ ¼è¨ºæ–­</h1>
                    <span class="sub-title-badge">ã€ˆK9 Harmony ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ç›£ä¿®ã€‰</span>
                    <p class="description-text">æ„›çŠ¬ã®è¡Œå‹•ã‹ã‚‰ã€æ½œåœ¨çš„ãªæ‚©ã¿ã¨<br>æœ€é©ãªçµ†ã®æ·±ã‚æ–¹ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚</p>
                </div>
                <div class="home-card reveal-item" id="reveal-3">
                    <div class="input-group">
                        <label>æ„›çŠ¬ã®åå‰</label>
                        <input type="text" id="dogName" placeholder="ä¾‹ï¼šãƒãƒ" maxlength="10">
                    </div>
                </div>
                <div class="btn-container reveal-item" id="reveal-4">
                    <button class="btn btn-ready" id="startBtn">è¨ºæ–­ã‚’å§‹ã‚ã‚‹</button>
                    <p style="margin-top:25px;"><span id="openPrivacy" style="text-decoration:underline; font-size:0.75rem; cursor:pointer; color:var(--neutral-border);">å€‹äººæƒ…å ±ä¿è­·æ–¹é‡</span></p>
                </div>
            </section>

            <section class="page-section" id="page-groupA">
                <div id="groupA-list"></div>
                <div class="btn-container">
                    <button class="btn" id="toGroupB" disabled>æ¬¡ã¸é€²ã‚€</button>
                </div>
            </section>

            <section class="page-section" id="page-groupB">
                <div id="groupB-list"></div>
                <div style="display:flex; justify-content:space-between; align-items:center; width:85%; margin:40px auto 0;">
                    <span id="backToA" style="cursor:pointer; font-size:0.8rem; color:var(--neutral-border); text-decoration:underline;">æˆ»ã‚‹</span>
                    <button class="btn" id="toGroupC" disabled style="width:75%;">æ¬¡ã¸é€²ã‚€</button>
                </div>
            </section>

            <section class="page-section" id="page-groupC">
                <div id="groupC-list"></div>
                <div style="display:flex; justify-content:space-between; align-items:center; width:85%; margin:40px auto 0;">
                    <span id="backToB" style="cursor:pointer; font-size:0.8rem; color:var(--neutral-border); text-decoration:underline;">æˆ»ã‚‹</span>
                    <button class="btn" id="finishBtn" disabled style="width:75%;">çµæœã‚’è¦‹ã‚‹</button>
                </div>
            </section>
        </div>
    </div>

    <div id="resultArea" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--mist-background); z-index:500; overflow-y:auto; padding:40px 20px; box-sizing:border-box;">
        <div class="card" style="text-align:center; background:rgba(255,255,255,0.7); border:1px solid var(--neutral-border); padding:30px;">
            <h2 id="resultTypeTitle" style="color:var(--progress-track); margin-top:0;">è¨ºæ–­çµæœ</h2>
            <img id="generatedImageOutput" style="width:100%; border:1px solid var(--neutral-border); margin:20px 0;">
            <div id="resultDescription" style="text-align:left; font-size:0.85rem; line-height:1.8;"></div>
            <button class="btn btn-ready" id="shareBtn" style="margin-top:30px; width:80%;">å‹ã ã¡ã«é€ã‚‹</button>
            <p onclick="location.reload()" style="margin-top:30px; cursor:pointer; font-size:0.8rem; color:var(--neutral-border);">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</p>
        </div>
    </div>

    <footer class="site-footer reveal-item" id="reveal-5">
        <div class="footer-logo-container">
            <img src="https://raw.githubusercontent.com/k9harmony-h/training_report/main/K9_logoFull.png" class="footer-logo-img" alt="K9 Harmony">
        </div>
        <div class="footer-info">
            <p><strong>K9 Harmony</strong></p>
            <p>ã€’174-0063 æ±äº¬éƒ½æ¿æ©‹åŒºå‰é‡ç”º6-55-1</p>
            <p>070-9043-1109</p>
        </div>
        <div style="margin-top:20px;">&copy; 2025 K9 Harmony</div>
    </footer>

    <div class="modal" id="privacyModal">
        <div class="modal-content">
            <h3 style="margin-top:0; color:var(--progress-track);">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</h3>
            <div id="policyContent" class="policy-body"></div>
            <div id="closePrivacy" style="margin-top:20px; text-align:center; padding:15px; background:var(--mist-background); cursor:pointer;">é–‰ã˜ã‚‹</div>
        </div>
    </div>

    <div id="chekiWrapper">
        <div id="chekiTemplate">
            <div class="cheki-photo-area">
                <div class="cheki-result-badge" id="tmpl_type">ã‚¿ã‚¤ãƒ—å</div>
                <div style="font-size:60px; margin-top:60px;">ğŸ¾</div>
                <div class="cheki-hashtag">#K9Harmony #æ„›çŠ¬ã®æ€§æ ¼è¨ºæ–­</div>
            </div>
            <div class="cheki-name-area" id="tmpl_name">åå‰</div>
        </div>
    </div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
/**
 * [K9 Harmony Engine]
 * 10å¹´å¾Œã®ä¿å®ˆæ€§ã‚’è€ƒæ…®ã—ã€å„é–¢æ•°ã®è²¬å‹™ã‚’æ˜ç¢ºåŒ–ã€‚
 */
const CONFIG = {
    LIFF_ID: "2008546673-MJY7j3ox",
    GAS_URL: "https://script.google.com/macros/s/AKfycbwyzFB78jRF4skpjakJrlozJJyTUOJqUtzmnF0aQVE89_rROwwwup6bVKhkNpvK6wqPrg/exec"
};

// è³ªå•ãƒ‡ãƒ¼ã‚¿ï¼ˆå›ºå®šï¼‰
const QUESTIONS = [
    { id: 1, grp: 'A', text: "Q1, åˆã‚ã¦ã®å ´æ‰€ã§", opts: [{t:"ä¸å®‰",s:1},{t:"è­¦æˆ’",s:10},{t:"å¹³æ°—",s:100}] },
    { id: 2, grp: 'A', text: "Q2, ä»–ã®çŠ¬ã¸ã®åå¿œ", opts: [{t:"é¿ã‘ã‚‹",s:1},{t:"æ³¨è¦–",s:10},{t:"éŠã¶",s:100}] },
    { id: 3, grp: 'A', text: "Q3, éŠã³ã¸ã®æ„æ¬²", opts: [{t:"ä½ã„",s:1},{t:"æ™®é€š",s:10},{t:"é«˜ã„",s:100}] },
    { id: 4, grp: 'B', text: "Q4, é£¼ã„ä¸»ã¸ã®è¿½å¾“", opts: [{t:"ãªã—",s:1},{t:"æ™‚ã€…",s:10},{t:"å¸¸ã«",s:100}] },
    { id: 5, grp: 'B', text: "Q5, ç•™å®ˆç•ªã®æ§˜å­", opts: [{t:"å¹³æ°—",s:1},{t:"ã‚½ãƒ¯ã‚½ãƒ¯",s:10},{t:"ãƒ‘ãƒ‹ãƒƒã‚¯",s:100}] },
    { id: 6, grp: 'B', text: "Q6, æ’«ã§çµ‚ãˆãŸå¾Œ", opts: [{t:"å»ã‚‹",s:1},{t:"åœæ­¢",s:10},{t:"å‚¬ä¿ƒ",s:100}] },
    { id: 7, grp: 'C', text: "Q7, ä»Šå¾Œã®å¸Œæœ›ã¯ï¼Ÿ", opts: [{t:"è‡ªç«‹ã—ã¦ã»ã—ã„",s:-1},{t:"ä»Šã®ã¾ã¾ã§è‰¯ã„",s:0},{t:"ã‚‚ã£ã¨ç”˜ãˆã¦ã»ã—ã„",s:1}] }
];

let state = { userId: null, dogName: "", answers: {} };

/** [Logger] é–‹ç™ºç”¨ãƒ­ã‚°å‡ºåŠ› */
function log(msg) {
    const ts = new Date().toLocaleTimeString();
    document.getElementById('logOverlay').innerText = `[${ts}] ${msg}`;
}

/**
 * [Opening Sequence]
 * å¯¾ç­–â‘ ï¼šPromise.allã‚’ç”¨ã„ã¦ã€æ¼”å‡ºã¨ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ã‚’åŒæœŸã•ã›ã‚‹ã€‚
 * ãƒ­ãƒ¼ãƒ‰ç”»é¢ã‚’èª¤é­”åŒ–ã™ãŸã‚ã€å³æ™‚é–‹å§‹ã™ã‚‹ã€‚
 */
async function playOpeningSequence() {
    log("é“å…·ã‚’æ•´ãˆã¦ã„ã¾ã™...");
    // èƒŒæ™¯å’Œç´™ã‚’ãµã‚ã£ã¨è¡¨ç¤º
    document.getElementById('washiBg').style.opacity = 1;

    // å„è¦ç´ ã‚’é †æ¬¡ã‚¤ãƒ¼ã‚ºã‚¤ãƒ³ã•ã›ã‚‹ã‚¿ã‚¤ãƒãƒ¼è¨­å®š
    const animationPromises = [
        { id: 'reveal-1', delay: 200 },
        { id: 'reveal-2', delay: 400 },
        { id: 'reveal-3', delay: 600 },
        { id: 'reveal-4', delay: 800 },
        { id: 'reveal-5', delay: 1000 }
    ].map(item => new Promise(resolve => {
        setTimeout(() => {
            const el = document.getElementById(item.id);
            if (el) el.classList.add('reveal-active');
            resolve();
        }, item.delay);
    }));

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨LIFFåˆæœŸåŒ–ã‚’ä¸¦è¡Œã—ã¦è¡Œã„ã€ä¸¡æ–¹ã®å®Œäº†ã‚’å¾…ã¤ï¼ˆå …ç‰¢æ€§å‘ä¸Šï¼‰
    await Promise.all([...animationPromises, initLiff()]);
    log("æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚");
}

/** [LIFF] åˆæœŸåŒ–å‡¦ç† */
async function initLiff() {
    try {
        await liff.init({ liffId: CONFIG.LIFF_ID });
        if (!liff.isLoggedIn()) liff.login();
        state.userId = liff.getContext().userId;
        log("LIFFæ¥ç¶šå®Œäº†ã€‚");
    } catch (e) { log("LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ï¼ˆå‹•ä½œã«å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚"); }
}

/** [Navigator] ãƒšãƒ¼ã‚¸é·ç§»åˆ¶å¾¡ */
function navigate(fromId, toId, direction) {
    const fromEl = document.getElementById(fromId);
    const toEl = document.getElementById(toId);
    fromEl.classList.remove('active');
    fromEl.classList.add(direction === 'next' ? 'exit-left' : 'exit-right');
    
    setTimeout(() => {
        fromEl.classList.add('hidden');
        fromEl.classList.remove('exit-left', 'exit-right');
        toEl.classList.remove('hidden');
        void toEl.offsetWidth; // ãƒªãƒ•ãƒ­ãƒ¼å¼·åˆ¶
        toEl.classList.add('active', 'enter-down');
    }, 400);
}

/** [UI Builder] è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹ç¯‰ */
function buildSection(group, targetId) {
    const container = document.getElementById(targetId);
    container.innerHTML = '';
    QUESTIONS.filter(q => q.grp === group).forEach(q => {
        const div = document.createElement('div');
        div.className = 'q-unit';
        div.innerHTML = `<div class="q-text">${q.text}</div>`;
        const optGroup = document.createElement('div');
        optGroup.className = 'opt-group';
        q.opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt.t;
            btn.onclick = () => {
                // é¸æŠçŠ¶æ…‹ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆCSSã§å¸ç€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒç™ºå‹•ï¼‰
                optGroup.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                state.answers[q.id] = opt.s;
                checkReady(group);
            };
            optGroup.appendChild(btn);
        });
        div.appendChild(optGroup);
        container.appendChild(div);
    });
}

/** [Validator] ã‚»ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†åˆ¤å®š */
function checkReady(group) {
    const qCount = QUESTIONS.filter(q => q.grp === group).length;
    const answered = QUESTIONS.filter(q => q.grp === group && state.answers[q.id] !== undefined).length;
    if (qCount === answered) {
        const btnId = group === 'A' ? 'toGroupB' : group === 'B' ? 'toGroupC' : 'finishBtn';
        const btn = document.getElementById(btnId);
        btn.disabled = false;
        btn.classList.add('btn-ready');
    }
}

/** [Initializer] ã‚¢ãƒ—ãƒªåˆæœŸåŒ– */
function init() {
    // åˆæœŸã‚²ãƒ¼ãƒˆã‚’å»ƒæ­¢ã—ã€å³æ™‚ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é–‹å§‹
    playOpeningSequence();

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²
    document.getElementById('startBtn').onclick = () => {
        state.dogName = document.getElementById('dogName').value.trim();
        if (!state.dogName) return alert("ãŠåå‰ã‚’æ•™ãˆã¦ãã ã•ã„");
        buildSection('A', 'groupA-list');
        navigate('page-home', 'page-groupA', 'next');
    };

    document.getElementById('toGroupB').onclick = () => { buildSection('B', 'groupB-list'); navigate('page-groupA', 'page-groupB', 'next'); };
    document.getElementById('toGroupC').onclick = () => { buildSection('C', 'groupC-list'); navigate('page-groupB', 'page-groupC', 'next'); };
    document.getElementById('backToA').onclick = () => navigate('page-groupB', 'page-groupA', 'back');
    document.getElementById('backToB').onclick = () => navigate('page-groupC', 'page-groupB', 'back');
    document.getElementById('finishBtn').onclick = processFinal;

    document.getElementById('openPrivacy').onclick = () => {
        document.getElementById('policyContent').innerHTML = "K9 Harmony ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼å…¨æ–‡...";
        document.getElementById('privacyModal').style.display = 'flex';
    };
    document.getElementById('closePrivacy').onclick = () => { document.getElementById('privacyModal').style.display = 'none'; };
}

/** [Processor] è¨ºæ–­çµæœè¨ˆç®—ãƒ»è¡¨ç¤º */
async function processFinal() {
    log("è¨ºæ–­çµæœã‚’é›†è¨ˆä¸­...");
    const sX = state.answers[1] + state.answers[2] + state.answers[3];
    const sY = state.answers[4] + state.answers[5] + state.answers[6];
    const c = state.answers[7];

    const getR = (s) => (s <= 12 ? 'LOW' : s <= 111 ? 'MID' : 'HIGH');
    let rX = getR(sX), rY = getR(sY);
    if ((sX === 12 || sX === 13) && c === 1) rX = 'MID';
    if ((sX === 12 || sX === 13) && c === -1) rX = 'LOW';

    const m = { 'LOW_LOW':'å“²å­¦è€…', 'MID_LOW':'è¦³å¯Ÿè€…', 'HIGH_LOW':'å†’é™ºå®¶', 'LOW_MID':'ã®ã‚“ã³ã‚Š', 'MID_MID':'é»„é‡‘ãƒãƒ©ãƒ³ã‚¹', 'HIGH_MID':'ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ', 'LOW_HIGH':'å†…å‘çš„å®ˆè­·è€…', 'MID_HIGH':'ç”˜ãˆã‚“åŠ', 'HIGH_HIGH':'è¡å‹•çš„' };
    const type = m[`${rX}_${rY}`] + "ã‚¿ã‚¤ãƒ—";

    document.getElementById('resultArea').classList.remove('hidden');
    document.getElementById('resultTypeTitle').innerText = `è¨ºæ–­çµæœï¼š${type}`;
    
    document.getElementById('tmpl_type').innerText = type;
    // æ•¬ç§°ã‚’å‰Šé™¤ã—ã€åå‰ã®ã¿ã‚’è¨­å®š
    document.getElementById('tmpl_name').innerText = state.dogName;
    
    // ç”»åƒç”Ÿæˆ
    html2canvas(document.getElementById('chekiTemplate'), { scale: 2 }).then(canvas => {
        document.getElementById('generatedImageOutput').src = canvas.toDataURL();
        log("è¨ºæ–­å®Œäº†ã€‚");
    });

    // GASã¸é€ä¿¡
    fetch(CONFIG.GAS_URL, { method:'POST', mode:'no-cors', body: JSON.stringify({ uid:state.userId, dogName:state.dogName, scoreX:sX, scoreY:sY, resultType:type }) });
}

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
init();
</script>
</body>
</html>
