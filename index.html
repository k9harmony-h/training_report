<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>K9 Harmony Portal</title>
  
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Lato:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div id="loadingOverlay">
    <div class="loading-content">
        <div class="spinner-border spinner-border-brand" role="status"></div>
        <p id="tipsText">Loading...</p>
    </div>
  </div>

  <div id="celebrationOverlay">
      <div id="celebNightSky"></div>
      <div id="celebStars"></div>
      <div id="celebLightContainer">
          <div id="celebLightCore"></div>
          <div id="celebLightRing"></div>
          <div id="celebLightOval"></div>
      </div>
      <canvas id="celebFireworksCanvas"></canvas>
      <div id="celebBadgeContainer"></div>
      <div id="celebCloseArea" onclick="closeCelebration()"></div> <div class="celeb-close-text">Tap to Close</div>
  </div>
  <canvas id="fairyDustCanvas"></canvas>

  <div id="errorView">
    <div class="container">
      <div class="alert alert-warning text-center" style="border-radius:12px; background:#fff3cd; border:1px solid #ffeeba;">
        <h5 class="fw-bold" id="errorTitle" style="color:#856404; font-family:var(--font-serif-jp);">申し訳ございません</h5>
        <p class="small" id="errorMessage" style="color:#856404;">処理に失敗しました。</p>
        <div class="line-id-box" id="dispLineId" style="display:none;"></div>
        <button class="btn btn-secondary btn-sm w-100 mt-2" onclick="location.reload()">再読み込み</button>
      </div>
    </div>
  </div>

  <div id="mainContent">
    <div class="header-area">
      <div class="logo-container">
          <img src="https://raw.githubusercontent.com/k9harmony-h/training_report/main/K9_logoFull.png" class="logo-img" alt="K9 Harmony" onerror="this.style.display='none'">
      </div>
      
      <div class="profile-card">
        <div id="dogImgContainer"></div>
        <div class="profile-info">
          <div id="custBirthdayMsg" class="birthday-msg">🎉 Happy Birthday</div>
          <p id="custName" class="cust-name">Loading...</p>
          <div style="height: 5px;"></div>
          <div id="dogBirthdayMsg" class="birthday-msg">🎉 Happy Birthday</div>
          <h2 id="dogName" class="dog-name">---</h2>
          <div class="lesson-meta"><span id="lessonDate">Last: --/--/--</span></div>
          <a href="history.html" id="historyLinkBtn" class="history-link">History &gt;</a>
        </div>
      </div>
    </div>

    <div class="chart-section">
      <div class="chart-box"><canvas id="chart1"></canvas><div class="chart-caption">基礎・集中</div></div>
      <div class="chart-box"><canvas id="chart2"></canvas><div class="chart-caption">応用・対応</div></div>
    </div>

    <div class="section-title">本日のテーマ・目標</div>
    <div class="feedback-box" id="goalText">---</div>
    <div class="section-title">できたこと (Done)</div>
    <div class="feedback-box" id="doneText">---</div>
    <div class="section-title">課題 (Unable)</div>
    <div class="feedback-box" id="unableText">---</div>
    
    <div class="section-title">宿題 (Homework)</div>
    <div class="homework-box">
      <div class="homework-badge">HOMEWORK</div>
      <div id="homeworkText">---</div>
    </div>

    <div class="section-title accent">次回目標 (Next Goal)</div>
    <div class="next-goal-box" id="nextGoalText">---</div>
    
    <div class="section-title">詳細フィードバック</div>
    <div class="detail-grid">
      <div class="detail-card"><div class="detail-head">項目1-5</div><div class="detail-body" id="detail1">---</div></div>
      <div class="detail-card"><div class="detail-head">項目6-10</div><div class="detail-body" id="detail2">---</div></div>
    </div>
    <div class="feedback-box mt-4" style="background:#fff; border:1px solid rgba(0,0,0,0.05);">
      <strong style="color:var(--c-sub-deep-ocean); font-family:var(--font-serif-jp);">トレーナーコメント:</strong><br><span id="trainerComment">---</span>
    </div>

    <div class="section-title">本日のショット</div>
    <div class="photo-scroll" id="photoArea"><div class="text-muted small ms-3" id="photoLoadingMsg">画像を読み込み中...</div></div>
    
    <div class="milestone-section">
        <div class="section-title" style="margin: 0 0 15px;">マイルストーン (K9 Harmony)</div>
        
        <div class="tier-container" id="milestone-container">
            <div class="tier-header" id="tier-header">Loading...</div>
            <div class="tier-badge-scroll" id="tier-scroll"></div>
        </div>

        <a class="ms-list-link" id="openAllMilestonesBtn">獲得マイルストーン一覧を見る &gt;</a>

        <a href="https://airrsv.net/k9h-rsv/calendar" target="_blank" class="btn-reserve">予約する / Reserve</a>
        <div id="reminderArea" class="reminder-box" style="display:none;">次回予約目安: <span id="reminderDate">--/-- 〜 --/--</span></div>
    </div>

    <div class="footer-action">
      <div class="text-muted small mt-2" style="font-family:var(--font-sans-en);">Ticket Balance: <span id="ticketCount" class="fw-bold" style="font-size:1.2rem; color:var(--c-main-turquoise);">-</span></div>
      <button id="btnSwitchDog" class="dog-select-btn" style="display:none;">愛犬情報の切替</button>
    </div>

    <footer class="site-footer">
        <div class="footer-logo-container">
            <img src="https://raw.githubusercontent.com/k9harmony-h/training_report/main/K9_logoFull.png" class="footer-logo-img" alt="K9 Harmony">
        </div>
        <div class="footer-info">
            <p><strong>K9 Harmony</strong></p>
            <p>東京都板橋区</p>
        </div>
        <div style="margin-top:20px;">&copy; 2025 K9 Harmony</div>
    </footer>
  </div>

  <div class="modal fade" id="milestoneModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center pt-0">
            <div id="msModalIconBox"></div>
            <h4 class="fw-bold mt-3 mb-2" id="msModalTitle" style="color: var(--c-sub-deep-ocean); font-family:var(--font-serif-jp);">Title</h4>
            <p class="text-muted small mb-3" id="msModalDesc">Description</p>
            <div id="msModalTipsBox">
                <strong style="font-family:var(--font-serif-en); letter-spacing:0.05em;"><i class="fa-solid fa-lightbulb"></i> Practical Tips</strong><br>
                <span id="msModalTips">Tips text here</span>
            </div>
        </div>
        <div class="modal-footer justify-content-center border-0 pb-4">
            <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal" style="background:var(--c-text-gray); border:none;">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="allMilestonesModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-sm-down modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title fw-bold" style="color:var(--c-sub-deep-ocean); font-family:var(--font-serif-jp);">獲得マイルストーン一覧</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="allMilestonesBody" style="background: var(--c-base-washi);"></div>
        <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="dogSelectModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0"><h5 class="modal-title fw-bold w-100 text-center" style="color:var(--c-sub-deep-ocean); font-family:var(--font-serif-jp);">愛犬情報の切替</h5></div>
        <div class="modal-body" id="dogSelectBody"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/common.js"></script>
  <script src="js/home.js"></script>
</body>
</html>
